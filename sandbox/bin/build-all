#!/bin/bash
trap onerr ERR

onerr(){ while caller $((n++)); do :; done; }

set -o errexit
set -o pipefail
set -o nounset


export GOOS=js
export GOARCH=wasm

# TODO currently links to all apps
wavURL="http://localhost:8080/test2.wav"
#wavURL="https://mgnsk.github.io/go-wasm-demos/public/test2.wav"

for app in /app/cmdwasm/*/
do
    app=$(basename $app)
    go build -ldflags "-X main.wavURL=$wavURL" -o /app/public/$app/$app.wasm /app/cmdwasm/$app/main.go
done
