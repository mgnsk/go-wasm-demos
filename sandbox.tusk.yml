tasks:
  go.generate:
    usage: Run go generate for a package.
    description: Running go.generate /app/... will generate complete app bundles with html and js.
    args:
      pkg:
        usage: Package
    run:
      - set-environment:
          GOOS: linux
          GOARCH: amd64
      - command: go generate -x ${pkg}

  go.test.linux:
    usage: Run go tests fo linux platform.
    description: Package path must be absolute, for example /app/...
    args:
      pkg:
        usage: Package
    run:
      - set-environment:
          GOOS: linux
          GOARCH: amd64
      - command: go test -v -count=1 ${pkg}

  go.test.wasm:
    usage: Run go wasm tests on headless chrome.
    args:
      pkg:
        usage: Package
    run:
      - set-environment:
          GOOS: js
          GOARCH: wasm
      - command: go test -v -count=1 ${pkg}

  go.build.wasm:
    usage: Build wasm apps.
    description: "For example: go.build.wasm cube."
    args:
      cmd:
        usage: Main package.
    run:
      - set-environment:
          GOOS: js
          GOARCH: wasm
      - command: go build -o /app/public/${cmd}/${cmd}.wasm /app/cmdwasm/${cmd}/main.go

  go.serve:
    usage: Run web server.
    run:
      - command: go run /app/cmd/serve/main.go
